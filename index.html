<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chessboard</title>
    <!-- (Removed external ML libraries; random AI only) -->
    <script>
        // Always force user through landing unless side explicitly in URL
        (function(){
            const path = window.location.pathname;
            const isIndex = /index\.html$/.test(path) || /\/$/.test(path);
            if (!isIndex) return;
            try {
                const params = new URLSearchParams(window.location.search);
                const side = params.get('side');
                if (!side) {
                    window.location.replace('landing.html');
                }
            } catch(e){
                window.location.replace('landing.html');
            }
        })();
    </script>
    <!-- Tailwind CDN for utility classes (odd/even row styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TensorFlow.js for experimental model-based engine (feature branch) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
    <link rel="stylesheet" href="styles.css?v=20250905a">
</head>
<body>
    <div class="app-layout">
        <!-- Model parameters tile (left of board) -->
    <div id="model-info-panel" aria-label="Model parameters and weights" role="region" style="border:2px solid var(--panel-border);border-radius:12px;padding:14px 16px 16px;box-shadow:0 4px 12px rgba(0,0,0,0.18),0 1px 2px rgba(0,0,0,0.12);">
            <div class="model-header-row"><div class="model-header">Model Weights</div><button id="refresh-weights-btn" type="button" class="model-refresh-btn" aria-label="Refresh model weights" title="Refresh model weights">‚Üª</button></div>
            <div class="model-meta">Engine: RandomMoveSelector<br><span class="note">All weights = 1</span></div>
            <div class="model-weights-wrapper">
                <table class="model-weights" aria-label="Model feature weights">
                    <thead><tr><th>Feature</th><th>W</th></tr></thead>
                    <tbody id="model-weight-body">
                        <tr><td>Material</td><td>1</td></tr>
                        <tr><td>Mobility</td><td>1</td></tr>
                        <tr><td>KingSafety</td><td>1</td></tr>
                        <tr><td>CenterControl</td><td>1</td></tr>
                        <tr><td>PawnStructure</td><td>1</td></tr>
                        <tr><td>PieceActivity</td><td>1</td></tr>
                        <tr><td>Pawn</td><td>1</td></tr>
                        <tr><td>Knight</td><td>1</td></tr>
                        <tr><td>Bishop</td><td>1</td></tr>
                        <tr><td>Rook</td><td>1</td></tr>
                        <tr><td>Queen</td><td>1</td></tr>
                        <tr><td>King</td><td>1</td></tr>
                    </tbody>
                </table>
            </div>
            <!-- Material balance section -->
            <div id="material-balance" style="margin-top:14px;padding-top:12px;border-top:1px solid var(--panel-border);">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
                    <div style="font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;">Material</div>
                    <div id="material-diff" class="material-diff" aria-label="Material difference" style="font-weight:700;font-size:14px;min-width:28px;text-align:right;">=</div>
                </div>
                <div class="captured-pieces" style="display:flex;flex-direction:column;gap:6px;">
                    <div style="display:flex;flex-direction:column;">
                        <div style="font-size:11px;font-weight:600;opacity:0.8;">Captured by White</div>
                        <div id="captured-by-white" class="captured-row" style="min-height:22px;"></div>
                    </div>
                    <div style="display:flex;flex-direction:column;">
                        <div style="font-size:11px;font-weight:600;opacity:0.8;">Captured by Black</div>
                        <div id="captured-by-black" class="captured-row" style="min-height:22px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="board-wrapper" style="position:relative;display:inline-block;">
            <div class="chessboard">
                <!-- Chessboard squares and pieces will be dynamically added here -->
            </div>
            <div id="clock-black" class="clock side-clock clock-top" data-color="Black" aria-label="Black clock" style="display:none;">
                <span class="clock-label">Black</span><span class="time">00:00</span>
            </div>
            <div id="clock-white" class="clock side-clock clock-bottom" data-color="White" aria-label="White clock" style="display:none;">
                <span class="clock-label">White</span><span class="time">00:00</span>
            </div>
        </div>
        <aside id="move-panel" aria-label="Move history panel">
            <div class="panel-header" style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;">
                <h3 style="margin:0;">Move History</h3>
                <div class="theme-toggle">
                    <input type="checkbox" id="theme-toggle" aria-label="Toggle dark mode">
                    <label for="theme-toggle" class="theme-toggle-label" title="Toggle dark mode">
                        <span class="icon sun" aria-hidden="true">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4a1 1 0 0 1-1-1V2a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1zm0 18a1 1 0 0 1-1-1v-1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1zm10-10a1 1 0 0 1-1 1h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1zM6 12a1 1 0 0 1-1 1H4a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1zm11.657-6.657a1 1 0 0 1 0 1.414L17.414 8a1 1 0 0 1-1.414-1.414l.243-.243a1 1 0 0 1 1.414 0zm-9.9 9.9a1 1 0 0 1 0 1.414L7.514 17.9A1 1 0 0 1 6.1 16.485l.243-.243a1 1 0 0 1 1.414 0zm9.9 1.414a1 1 0 0 1-1.414 0l-.243-.243A1 1 0 0 1 17.314 15.1l1.243 1.243a1 1 0 0 1 0 1.414zm-9.9-9.9a1 1 0 0 1-1.414 0l-.243-.243A1 1 0 0 1 7.515 6.1l1.243 1.243a1 1 0 0 1 0 1.414zM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z"/></svg>
                        </span>
                        <span class="icon moon" aria-hidden="true">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z"/></svg>
                        </span>
                        <span class="knob" aria-hidden="true"></span>
                    </label>
                </div>
                <button id="sound-toggle" type="button" aria-pressed="true" title="Toggle sound" style="margin-left:4px;border:none;background:var(--panel-border);color:var(--square-light);padding:6px 10px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;display:flex;align-items:center;gap:4px;">
                    <span class="sound-on">üîä</span>
                </button>
            </div>
            <div class="history-wrapper">
                <table id="history-table" class="history-table w-full" aria-live="polite">
                    <thead>
                        <tr><th class="w-8">#</th><th>White</th><th>Black</th></tr>
                    </thead>
                    <tbody id="history-body" class="text-sm"></tbody>
                </table>
            </div>
            <div class="nav-controls" style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;">
                <button id="nav-first" type="button" class="nav-btn" title="First position" aria-label="First Position">‚èÆÔ∏è</button>
                <button id="nav-prev" type="button" class="nav-btn" title="Previous position" aria-label="Previous Position">‚óÄÔ∏è</button>
                <button id="nav-next" type="button" class="nav-btn" title="Next position" aria-label="Next Position">‚ñ∂Ô∏è</button>
                <button id="nav-last" type="button" class="nav-btn" title="Latest position" aria-label="Latest Position">‚è≠Ô∏è</button>
            </div>
            <div id="result-banner" class="result-banner" role="status" aria-live="polite"></div>
            <div style="margin-top:8px;text-align:center;">
                <button id="new-game-btn" type="button" style="display:none; width:100%;">New Game</button>
            </div>
        </aside>
    </div>
    <script src="script.js?v=20250905-tf"></script>
</body>
</html>